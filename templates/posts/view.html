{% extends "base.html" %}

{% block title %}{{ post.title }} - Beer Field{% endblock %}

{% block content %}
<div class="post-view-container">
    <div class="post-view">
        <div class="post-vote-section">
            {% if current_user.is_authenticated %}
                <form method="POST" action="{{ url_for('upvote_post', post_id=post.id) }}" class="vote-form upvote-form">
                    <button class="vote-btn upvote-btn" title="–õ–∞–π–∫">‚ñ≤</button>
                </form>
                <span class="vote-count-large">{{ post.upvotes - post.downvotes }}</span>
                <form method="POST" action="{{ url_for('downvote_post', post_id=post.id) }}" class="vote-form downvote-form">
                    <button class="vote-btn downvote-btn" title="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
                </form>
            {% else %}
                <span class="vote-count-large">{{ post.upvotes - post.downvotes }}</span>
            {% endif %}
        </div>
        
        <div class="post-full-content">
            <div class="post-header-full">
                <div class="post-subreddit-full">r/{{ post.subreddit.name }}</div>
                <h1 class="post-title-full">{{ post.title }}</h1>
                
                <div class="post-meta">
                    <span class="post-author">
                        <img src="{{ post.author.avatar_url }}" alt="{{ post.author.username }}" class="meta-avatar">
                        <a href="{{ url_for('user_profile', username=post.author.username) }}">u/{{ post.author.username }}</a>
                    </span>
                    <span class="post-time">{{ post.created_at|timesince }}</span>
                    <span class="post-views">üëÅ {{ post.views }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                </div>
            </div>
            
            <div class="post-body">
                {% if post.content_type == 'text' %}
                    <div class="post-text">{{ post.content }}</div>
                {% elif post.content_type == 'image' %}
                    <img src="{{ post.url }}" alt="{{ post.title }}" class="post-full-image">
                {% elif post.content_type == 'link' %}
                    <p class="post-link-box">
                        <a href="{{ post.url }}" target="_blank" class="link-icon">üîó</a>
                        <a href="{{ post.url }}" target="_blank" class="link-text">{{ post.url }}</a>
                    </p>
                {% endif %}
            </div>
            
            <div class="post-actions-full">
                {% if current_user.is_authenticated %}
                    {% if current_user.is_post_saved(post) %}
                        <form method="POST" action="{{ url_for('unsave_post', post_id=post.id) }}" style="display: inline;">
                            <button class="action-btn saved">üîñ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</button>
                        </form>
                    {% else %}
                        <form method="POST" action="{{ url_for('save_post', post_id=post.id) }}" style="display: inline;">
                            <button class="action-btn">üîñ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </form>
                    {% endif %}
                    
                    {% if post.author_id == current_user.id or current_user.role == 'admin' %}
                        <a href="{{ url_for('edit_post', post_id=post.id) }}" class="action-btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" style="display: inline;">
                            <button class="action-btn danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?');">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    {% endif %}
                    
                    <a href="{{ url_for('report_post', post_id=post.id) }}" class="action-btn">‚ö†Ô∏è –û—Ç—á–µ—Ç</a>
                {% else %}
                    <p class="login-prompt"><a href="{{ url_for('login') }}">–í–æ–π–¥–∏—Ç–µ</a> —á—Ç–æ–±—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø–æ—Å—Ç–æ–º</p>
                {% endif %}
            </div>
            
            {% if post.updated_at != post.created_at %}
                <div class="post-edited">
                    –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ {{ post.updated_at|timesince }}
                </div>
            {% endif %}
        </div>
    </div>
    
    <div class="comments-section">
        <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comment_count }})</h2>
        
        {% if current_user.is_authenticated %}
            <div class="comment-form-box">
                <form method="POST" action="{{ url_for('create_comment', post_id=post.id) }}" class="form">
                    {{ form.hidden_tag() }}
                    
                    <div class="form-group">
                        {{ form.content(class="form-control", placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...", rows="3") }}
                        {% if form.content.errors %}
                            <div class="error">{{ form.content.errors[0] }}</div>
                        {% endif %}
                    </div>
                    
                    <button type="submit" class="btn btn-primary">–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>
            </div>
        {% else %}
            <p class="login-prompt"><a href="{{ url_for('login') }}">–í–æ–π–¥–∏—Ç–µ</a> —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
        {% endif %}
        
        <div class="sort-bar">
            <a href="{{ url_for('view_post', post_id=post.id, sort='best') }}" class="sort-link {% if sort == 'best' %}active{% endif %}">–õ—É—á—à–∏–µ</a>
            <a href="{{ url_for('view_post', post_id=post.id, sort='new') }}" class="sort-link {% if sort == 'new' %}active{% endif %}">–ù–æ–≤—ã–µ</a>
            <a href="{{ url_for('view_post', post_id=post.id, sort='top') }}" class="sort-link {% if sort == 'top' %}active{% endif %}">–¢–æ–ø</a>
            <a href="{{ url_for('view_post', post_id=post.id, sort='old') }}" class="sort-link {% if sort == 'old' %}active{% endif %}">–°—Ç–∞—Ä—ã–µ</a>
        </div>
        
        {% if comments.items %}
            <div class="comments-list">
                {% for comment in comments.items %}
                    {% include "posts/comment_item.html" %}
                {% endfor %}
            </div>
            
            {% if comments.pages > 1 %}
                <div class="pagination">
                    {% if comments.has_prev %}
                        <a href="{{ url_for('view_post', post_id=post.id, page=comments.prev_num, sort=sort) }}" class="pagination-link">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                    {% endif %}
                    
                    <span class="pagination-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ comments.page }} –∏–∑ {{ comments.pages }}</span>
                    
                    {% if comments.has_next %}
                        <a href="{{ url_for('view_post', post_id=post.id, page=comments.next_num, sort=sort) }}" class="pagination-link">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</a>
                    {% endif %}
                </div>
            {% endif %}
        {% else %}
            <p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
        {% endif %}
    </div>
</div>
{% endblock %}
